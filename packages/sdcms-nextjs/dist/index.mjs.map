{"version":3,"sources":["../src/client.ts","../src/components/SDCMSJsonLd.tsx","../src/utils/generateMetadata.ts"],"sourcesContent":["import type { SDCMSConfig, SEOMetadataResponse } from \"./types\";\n\n/**\n * SDCMS API Client\n * Handles all HTTP requests to the SDCMS API\n */\nexport class SDCMSClient {\n  private config: Required<SDCMSConfig>;\n  private cache: {\n    promise: Promise<SEOMetadataResponse> | null;\n    expiresAt: number;\n  } = { promise: null, expiresAt: 0 };\n\n  constructor(config: SDCMSConfig) {\n    if (!config.apiUrl) {\n      throw new Error(\"[SDCMS] apiUrl is required\");\n    }\n    if (!config.clientSlug) {\n      throw new Error(\"[SDCMS] clientSlug is required\");\n    }\n\n    this.config = {\n      debug: false,\n      revalidate: 3600,\n      ...config,\n      apiUrl: config.apiUrl.replace(/\\/+$/, \"\"),\n    };\n  }\n\n  private log(...args: unknown[]) {\n    if (this.config.debug) {\n      console.log(\"[SDCMS]\", ...args);\n    }\n  }\n\n  private async fetchAPI<T>(\n    endpoint: string,\n    options: RequestInit = {}\n  ): Promise<T> {\n    const url = `${this.config.apiUrl}${endpoint}`;\n    this.log(\"Fetching:\", url);\n\n    try {\n      const response = await fetch(url, {\n        ...options,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...options.headers,\n        },\n        // Next.js extends RequestInit with `next` options for ISR/caching\n        next: {\n          revalidate: this.config.revalidate,\n        },\n      } as RequestInit);\n\n      if (!response.ok) {\n        throw new Error(\n          `SDCMS API error: ${response.status} ${response.statusText}`\n        );\n      }\n\n      const data = await response.json();\n      this.log(\"Response:\", data);\n\n      return data;\n    } catch (error) {\n      console.error(\"[SDCMS] Error fetching from API:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Fetch all SEO metadata for the configured client.\n   * Results are cached in-memory for `revalidate` seconds.\n   */\n  async getSEOMetadata(): Promise<SEOMetadataResponse> {\n    if (this.cache.promise && Date.now() < this.cache.expiresAt) {\n      this.log(\"Returning cached metadata\");\n      return this.cache.promise;\n    }\n\n    const promise = this.fetchAPI<SEOMetadataResponse>(\n      `/api/public/seo-metadata?slug=${this.config.clientSlug}`\n    );\n\n    this.cache = {\n      promise,\n      expiresAt: Date.now() + this.config.revalidate * 1000,\n    };\n\n    promise.catch(() => {\n      this.cache = { promise: null, expiresAt: 0 };\n    });\n\n    return promise;\n  }\n\n  /**\n   * Invalidate the in-memory cache, forcing the next call to refetch.\n   */\n  invalidateCache() {\n    this.cache = { promise: null, expiresAt: 0 };\n  }\n\n  /**\n   * Get sitemap XML content\n   */\n  async getSitemapXML(): Promise<string> {\n    const metadata = await this.getSEOMetadata();\n    return metadata.sitemap.xml;\n  }\n\n  /**\n   * Get robots.txt content\n   */\n  async getRobotsTxt(): Promise<string> {\n    const metadata = await this.getSEOMetadata();\n    return metadata.robots.txt;\n  }\n\n  /**\n   * Get organization JSON-LD schema\n   */\n  async getOrganizationSchema(): Promise<object> {\n    const metadata = await this.getSEOMetadata();\n    return metadata.schemas.organization;\n  }\n\n  /**\n   * Get website JSON-LD schema\n   */\n  async getWebSiteSchema(): Promise<object> {\n    const metadata = await this.getSEOMetadata();\n    return metadata.schemas.website;\n  }\n\n  /**\n   * Get blog posts metadata\n   */\n  async getBlogPosts(options?: {\n    limit?: number;\n    offset?: number;\n    tags?: string[];\n    type?: string;\n    lang?: string;\n  }) {\n    const metadata = await this.getSEOMetadata();\n    let posts = metadata.posts;\n\n    // Apply filters\n    if (options?.tags && options.tags.length > 0) {\n      posts = posts.filter((post) =>\n        options.tags!.some((tag) => post.tags.includes(tag))\n      );\n    }\n\n    if (options?.type) {\n      posts = posts.filter((post) => post.type === options.type);\n    }\n\n    if (options?.lang) {\n      posts = posts.filter((post) => post.lang === options.lang);\n    }\n\n    // Apply pagination\n    const offset = options?.offset || 0;\n    const limit = options?.limit || 10;\n    posts = posts.slice(offset, offset + limit);\n\n    return posts;\n  }\n\n  /**\n   * Get single blog post by ID\n   */\n  async getBlogPost(id: string) {\n    const metadata = await this.getSEOMetadata();\n    return metadata.posts.find((post) => post.id === id);\n  }\n\n  /**\n   * Get full content body for a post (from cached metadata)\n   */\n  async getContentBody(id: string): Promise<{\n    id: string;\n    title: string;\n    content: string;\n    excerpt: string | null;\n    author: string;\n    publishedAt: string;\n    updatedAt: string;\n    tags: string[];\n    type: string;\n    lang: string;\n  } | null> {\n    const metadata = await this.getSEOMetadata();\n    const post = metadata.posts.find((p) => p.id === id);\n    \n    if (!post) {\n      return null;\n    }\n\n    return {\n      id: post.id,\n      title: post.title,\n      content: post.content || \"\",\n      excerpt: post.description,\n      author: post.author,\n      publishedAt: post.publishedAt || \"\",\n      updatedAt: post.updatedAt,\n      tags: post.tags,\n      type: post.type,\n      lang: post.lang,\n    };\n  }\n}\n\n/**\n * Create a new SDCMS client instance\n */\nexport function createSDCMSClient(config: SDCMSConfig): SDCMSClient {\n  return new SDCMSClient(config);\n}\n","import type { OrganizationSchema, WebSiteSchema, PostMetadata } from \"../types\";\n\ninterface SDCMSJsonLdProps {\n  /**\n   * Organization schema from SDCMS\n   */\n  organization?: OrganizationSchema;\n\n  /**\n   * Website schema from SDCMS\n   */\n  website?: WebSiteSchema;\n\n  /**\n   * Post-specific schema (for blog posts)\n   */\n  post?: PostMetadata & {\n    content?: string; // Article body text\n  };\n}\n\n/**\n * Component to inject JSON-LD structured data from SDCMS\n * \n * @example\n * ```tsx\n * <SDCMSJsonLd\n *   organization={metadata.schemas.organization}\n *   website={metadata.schemas.website}\n * />\n * ```\n */\nexport function SDCMSJsonLd({\n  organization,\n  website,\n  post,\n}: SDCMSJsonLdProps) {\n  const schemas = [];\n\n  if (organization) {\n    schemas.push(organization);\n  }\n\n  if (website) {\n    schemas.push(website);\n  }\n\n  if (post) {\n    // Generate Article schema for blog posts\n    const articleSchema = {\n      \"@context\": \"https://schema.org\",\n      \"@type\": post.schemaType || \"Article\",\n      headline: post.title,\n      description: post.description,\n      image: post.image,\n      author: {\n        \"@type\": \"Person\",\n        name: post.author,\n      },\n      datePublished: post.publishedAt,\n      dateModified: post.updatedAt,\n      ...(post.url && { url: post.url }),\n    };\n\n    schemas.push(articleSchema);\n  }\n\n  if (schemas.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {schemas.map((schema, index) => (\n        <script\n          key={index}\n          type=\"application/ld+json\"\n          dangerouslySetInnerHTML={{\n            __html: JSON.stringify(schema, null, 2),\n          }}\n        />\n      ))}\n    </>\n  );\n}\n","import type { DefaultMeta, PostMetadata } from \"../types\";\n\ntype OpenGraphType =\n  | \"article\"\n  | \"website\"\n  | \"book\"\n  | \"profile\"\n  | \"music.song\"\n  | \"music.album\"\n  | \"music.playlist\"\n  | \"music.radio_station\"\n  | \"video.movie\"\n  | \"video.episode\"\n  | \"video.tv_show\"\n  | \"video.other\";\n\ntype TwitterCardType = \"summary\" | \"summary_large_image\" | \"app\" | \"player\";\n\n/**\n * Metadata shape compatible with Next.js App Router's Metadata type.\n * We intentionally don't import from \"next\" to avoid cross-package\n * type resolution issues when using file: dependencies.\n */\nexport interface SDCMSMetadataResult {\n  title: string;\n  description: string;\n  keywords: string[];\n  authors: Array<{ name: string }>;\n  openGraph: {\n    type: OpenGraphType;\n    title: string;\n    description: string;\n    images: Array<{ url: string }>;\n    publishedTime?: string;\n    modifiedTime?: string;\n  };\n  twitter: {\n    card: TwitterCardType;\n    title: string;\n    description: string;\n    images: string[];\n    site?: string;\n  };\n  other?: Record<string, string>;\n}\n\n/**\n * Generate Next.js Metadata object from SDCMS data\n * For use in Server Components with Next.js 13+ App Router\n *\n * The return type is structurally compatible with Next.js Metadata,\n * so you can return it directly from generateMetadata().\n *\n * @example\n * ```tsx\n * // app/blog/[slug]/page.tsx\n * export async function generateMetadata({ params }): Promise<Metadata> {\n *   const metadata = await getSDCMSMetadata();\n *   const post = metadata.posts.find(p => p.url.includes(params.slug));\n *\n *   return generateMetadataFromSDCMS(metadata.meta, post);\n * }\n * ```\n */\nexport function generateMetadataFromSDCMS(\n  defaultMeta: DefaultMeta,\n  post?: PostMetadata\n): SDCMSMetadataResult {\n  const title = post?.title || defaultMeta.title;\n  const description = post?.description || defaultMeta.description;\n  const image = post?.image || defaultMeta.ogImage;\n\n  const openGraph = {\n    type: (post?.ogType || defaultMeta.ogType) as OpenGraphType,\n    title,\n    description,\n    images: image ? [{ url: image }] : [],\n    ...(post?.publishedAt && {\n      publishedTime: post.publishedAt,\n    }),\n    ...(post?.updatedAt && {\n      modifiedTime: post.updatedAt,\n    }),\n  };\n\n  const twitter = {\n    card: (post?.twitterCard || defaultMeta.twitterCard) as TwitterCardType,\n    title,\n    description,\n    images: image ? [image] : [],\n    ...(defaultMeta.twitterSite && {\n      site: defaultMeta.twitterSite,\n    }),\n  };\n\n  return {\n    title,\n    description,\n    keywords: defaultMeta.keywords,\n    authors: post?.author ? [{ name: post.author }] : [{ name: defaultMeta.author }],\n    openGraph,\n    twitter,\n    ...(post?.tags && {\n      other: {\n        tags: post.tags.join(\", \"),\n      },\n    }),\n  };\n}\n\n/**\n * Generate sitemap entries for Next.js sitemap.xml\n *\n * @example\n * ```tsx\n * // app/sitemap.ts\n * export default async function sitemap() {\n *   const metadata = await getSDCMSMetadata();\n *   return generateSitemapFromSDCMS(metadata.sitemap.entries);\n * }\n * ```\n */\nexport function generateSitemapFromSDCMS(entries: Array<{\n  loc: string;\n  lastmod: string;\n  changefreq: string;\n  priority: number;\n}>) {\n  return entries.map((entry) => ({\n    url: entry.loc,\n    lastModified: new Date(entry.lastmod),\n    changeFrequency: entry.changefreq as\n      | \"always\"\n      | \"hourly\"\n      | \"daily\"\n      | \"weekly\"\n      | \"monthly\"\n      | \"yearly\"\n      | \"never\",\n    priority: entry.priority,\n  }));\n}\n"],"mappings":"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","names":[]}